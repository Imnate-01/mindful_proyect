"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ai/route";
exports.ids = ["app/api/ai/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_trevo_OneDrive_Im_genes_mindful_campus_next_mindful_campus_next_app_api_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ai/route.ts */ \"(rsc)/./app/api/ai/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ai/route\",\n        pathname: \"/api/ai\",\n        filename: \"route\",\n        bundlePath: \"app/api/ai/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\trevo\\\\OneDrive\\\\Imágenes\\\\mindful-campus-next\\\\mindful-campus-next\\\\app\\\\api\\\\ai\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_trevo_OneDrive_Im_genes_mindful_campus_next_mindful_campus_next_app_api_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ai/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhaSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYWklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhaSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUN0cmV2byU1Q09uZURyaXZlJTVDSW0lQzMlQTFnZW5lcyU1Q21pbmRmdWwtY2FtcHVzLW5leHQlNUNtaW5kZnVsLWNhbXB1cy1uZXh0JTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUN0cmV2byU1Q09uZURyaXZlJTVDSW0lQzMlQTFnZW5lcyU1Q21pbmRmdWwtY2FtcHVzLW5leHQlNUNtaW5kZnVsLWNhbXB1cy1uZXh0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNzRDtBQUNuSTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL21pbmRmdWwtY2FtcHVzLW5leHQvPzVjYzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcdHJldm9cXFxcT25lRHJpdmVcXFxcSW3DoWdlbmVzXFxcXG1pbmRmdWwtY2FtcHVzLW5leHRcXFxcbWluZGZ1bC1jYW1wdXMtbmV4dFxcXFxhcHBcXFxcYXBpXFxcXGFpXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9haS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FpXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9haS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXHRyZXZvXFxcXE9uZURyaXZlXFxcXEltw6FnZW5lc1xcXFxtaW5kZnVsLWNhbXB1cy1uZXh0XFxcXG1pbmRmdWwtY2FtcHVzLW5leHRcXFxcYXBwXFxcXGFwaVxcXFxhaVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYWkvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/ai/route.ts":
/*!*****************************!*\
  !*** ./app/api/ai/route.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n// app/api/ai/route.ts\n\n/** Orden de preferencia: Sonnet 4.5 -> Haiku 4.5 -> Haiku 3.5 */ const candidateModels = [\n    \"claude-sonnet-4-5-20250929\",\n    \"claude-haiku-4-5-20251001\",\n    \"claude-3-5-haiku-20241022\"\n];\nfunction getHeaders() {\n    const key = process.env.ANTHROPIC_API_KEY;\n    return {\n        key,\n        headers: {\n            \"content-type\": \"application/json\",\n            \"x-api-key\": key || \"\",\n            \"anthropic-version\": \"2023-06-01\"\n        }\n    };\n}\nfunction buildPayload(text) {\n    return {\n        max_tokens: 1200,\n        messages: [\n            {\n                role: \"user\",\n                content: `Eres un analista emocional para estudiantes universitarios.\r\nDevuelve SOLO JSON válido (sin markdown, sin comentarios) con este EXACTO esquema:\r\n\r\n{\r\n  \"emotions\": [\r\n    {\"emotion\": \"ansiedad\", \"intensity\": 7, \"confidence\": 0.83, \"phrases\": [\"...\",\"...\"]}\r\n  ],\r\n  \"primary\": \"ansiedad\",\r\n  \"mood_vector\": {\"valence\": 0.32, \"arousal\": 0.74},\r\n  \"triggers\": [\"...\"],\r\n  \"body_signals\": [\"...\"],\r\n  \"cognitive_patterns\": [\"...\"],\r\n  \"protective_factors\": [\"...\"],\r\n  \"summary\": \"máx 180 caracteres, tono empático y no clínico\",\r\n  \"suggestions_quick\": [\"Tip 1\", \"Tip 2\"],\r\n  \"suggestions_practice\": [\r\n    {\"title\": \"Respiración box\", \"minutes\": 3, \"steps\": [\"Paso 1\",\"Paso 2\",\"Paso 3\"]}\r\n  ],\r\n  \"red_flags\": {\"self_harm\": false, \"crisis\": false, \"reason\": \"\"},\r\n  \"citations\": []\r\n}\r\n\r\nReglas:\r\n- Emociones válidas: ansiedad, calma, alegria, tristeza, enojo, frustracion, neutra\r\n- \"intensity\": 1..10, \"confidence\": 0..1\r\n- Máx 3 emociones; máx 2 frases por emoción (<=60 chars)\r\n- Máx 2 suggestions_quick y 1 suggestions_practice (3–5 min)\r\n- Evita diagnósticos clínicos. Solo orientación de bienestar.\r\n- Entrega SOLO el JSON, sin \\`\\`\\`, sin texto extra.\r\n\r\nTexto:\r\n\"${text}\"`\n            }\n        ]\n    };\n}\nasync function tryModelsInOrder(payload, headers) {\n    for (const model of candidateModels){\n        try {\n            const res = await fetch(\"https://api.anthropic.com/v1/messages\", {\n                method: \"POST\",\n                headers,\n                body: JSON.stringify({\n                    ...payload,\n                    model\n                })\n            });\n            if (!res.ok) {\n                const text = await res.text();\n                console.log(`⚠️ ${model} -> ${res.status} ${res.statusText}: ${text.slice(0, 180)}`);\n                continue;\n            }\n            const json = await res.json();\n            console.log(`✅ Usando modelo: ${model}`);\n            return {\n                usedModel: model,\n                json\n            };\n        } catch (e) {\n            console.log(`⚠️ ${model} -> excepción`, e);\n        }\n    }\n    throw new Error(\"No hay modelos disponibles con tu API key.\");\n}\n/** Extrae el primer bloque JSON de un string o devuelve null */ function extractFirstJsonBlock(s) {\n    if (!s) return null;\n    const match = s.match(/\\{[\\s\\S]*\\}/);\n    if (!match) return null;\n    try {\n        return JSON.parse(match[0]);\n    } catch  {\n        return null;\n    }\n}\n/** Sanitiza y recorta campos para evitar valores fuera de rango */ function sanitizeResponse(raw) {\n    const clamp = (v, lo, hi)=>Math.max(lo, Math.min(hi, Number.isFinite(v) ? v : lo));\n    const emotions = Array.isArray(raw?.emotions) ? raw.emotions.slice(0, 3) : [];\n    const safeEmotions = emotions.map((e)=>({\n            emotion: [\n                \"ansiedad\",\n                \"calma\",\n                \"alegria\",\n                \"tristeza\",\n                \"enojo\",\n                \"frustracion\",\n                \"neutra\"\n            ].includes(e?.emotion) ? e.emotion : \"neutra\",\n            intensity: clamp(e?.intensity ?? 5, 1, 10),\n            confidence: clamp(e?.confidence ?? 0.7, 0, 1),\n            phrases: Array.isArray(e?.phrases) ? e.phrases.slice(0, 2) : []\n        }));\n    const primary = [\n        \"ansiedad\",\n        \"calma\",\n        \"alegria\",\n        \"tristeza\",\n        \"enojo\",\n        \"frustracion\",\n        \"neutra\"\n    ].includes(raw?.primary) ? raw.primary : safeEmotions[0]?.emotion ?? \"neutra\";\n    const mood_vector = {\n        valence: clamp(raw?.mood_vector?.valence ?? 0.5, 0, 1),\n        arousal: clamp(raw?.mood_vector?.arousal ?? 0.5, 0, 1)\n    };\n    const arr = (x)=>Array.isArray(x) ? x : [];\n    const str = (x, max = 180)=>typeof x === \"string\" ? x.slice(0, max) : \"\";\n    const response = {\n        emotions: safeEmotions,\n        primary,\n        mood_vector,\n        triggers: arr(raw?.triggers).slice(0, 6),\n        body_signals: arr(raw?.body_signals).slice(0, 6),\n        cognitive_patterns: arr(raw?.cognitive_patterns).slice(0, 6),\n        protective_factors: arr(raw?.protective_factors).slice(0, 6),\n        summary: str(raw?.summary, 180),\n        suggestions_quick: arr(raw?.suggestions_quick).slice(0, 2),\n        suggestions_practice: arr(raw?.suggestions_practice).slice(0, 1).map((p)=>({\n                title: str(p?.title, 60) || \"Pr\\xe1ctica breve\",\n                minutes: Math.max(1, Math.min(10, Number(p?.minutes) || 3)),\n                steps: arr(p?.steps).slice(0, 5)\n            })),\n        red_flags: {\n            self_harm: !!raw?.red_flags?.self_harm,\n            crisis: !!raw?.red_flags?.crisis,\n            reason: str(raw?.red_flags?.reason, 120)\n        },\n        citations: arr(raw?.citations).slice(0, 4)\n    };\n    return response;\n}\nasync function POST(req) {\n    console.log(\"=== INICIO /api/ai ===\");\n    const { key, headers } = getHeaders();\n    console.log(\"\\uD83D\\uDD11 API Key:\", key ? \"S\\xcd ✅\" : \"NO ❌\");\n    if (key) console.log(\"\\uD83D\\uDD11 Pre:\", key.slice(0, 20) + \"...\");\n    try {\n        const { text } = await req.json();\n        const preview = typeof text === \"string\" ? text.slice(0, 120) : \"\";\n        console.log(\"\\uD83D\\uDCDD Texto:\", preview + (text?.length > 120 ? \"...\" : \"\"));\n        if (!text || typeof text !== \"string\" || text.trim().length < 20) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Texto insuficiente (m\\xednimo 20 caracteres)\"\n            }, {\n                status: 400\n            });\n        }\n        if (!key) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing ANTHROPIC_API_KEY\"\n            }, {\n                status: 500\n            });\n        }\n        const payload = buildPayload(text);\n        const { usedModel, json } = await tryModelsInOrder(payload, headers);\n        // La API devuelve algo tipo: { content: [{ text: \"...(JSON o texto)...\" }], ... }\n        const content = json?.content?.[0]?.text ?? \"\";\n        const parsed = extractFirstJsonBlock(content);\n        if (!parsed) {\n            console.log(\"❌ No se encontr\\xf3 JSON en la respuesta bruta\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No JSON found in upstream response\"\n            }, {\n                status: 502\n            });\n        }\n        const sanitized = sanitizeResponse(parsed);\n        console.log(\"✅ OK ->\", usedModel);\n        console.log(\"=== FIN /api/ai ===\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            usedModel,\n            ...sanitized\n        });\n    } catch (err) {\n        console.error(\"❌ EXCEPTION /api/ai:\", err?.message || err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Exception\",\n            message: err?.message || \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUUwRCxPQUFPO1lBQTRDLEdBQ3JEO2dCQUFFN0QsUUFBUTtZQUFJO1FBRWxCO1FBRUEsSUFBSSxDQUFDdkIsS0FBSztZQUNSLE9BQU9ILHFEQUFZQSxDQUFDNkIsSUFBSSxDQUN0QjtnQkFBRTBELE9BQU87WUFBNEIsR0FDckM7Z0JBQUU3RCxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNWCxVQUFVUCxhQUFhQztRQUM3QixNQUFNLEVBQUVxQixTQUFTLEVBQUVELElBQUksRUFBRSxHQUFHLE1BQU1mLGlCQUFpQkMsU0FBU1I7UUFFNUQsa0ZBQWtGO1FBQ2xGLE1BQU1NLFVBQVVnQixNQUFNaEIsU0FBUyxDQUFDLEVBQUUsRUFBRUosUUFBUTtRQUM1QyxNQUFNK0UsU0FBU3ZELHNCQUFzQnBCO1FBQ3JDLElBQUksQ0FBQzJFLFFBQVE7WUFDWGhFLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE9BQU96QixxREFBWUEsQ0FBQzZCLElBQUksQ0FDdEI7Z0JBQUUwRCxPQUFPO1lBQXFDLEdBQzlDO2dCQUFFN0QsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTStELFlBQVlwRCxpQkFBaUJtRDtRQUNuQ2hFLFFBQVFDLEdBQUcsQ0FBQyxXQUFXSztRQUN2Qk4sUUFBUUMsR0FBRyxDQUFDO1FBRVosT0FBT3pCLHFEQUFZQSxDQUFDNkIsSUFBSSxDQUFDO1lBQ3ZCQztZQUNBLEdBQUcyRCxTQUFTO1FBQ2Q7SUFDRixFQUFFLE9BQU9DLEtBQVU7UUFDakJsRSxRQUFRK0QsS0FBSyxDQUFDLHdCQUF3QkcsS0FBS0MsV0FBV0Q7UUFDdEQsT0FBTzFGLHFEQUFZQSxDQUFDNkIsSUFBSSxDQUN0QjtZQUFFMEQsT0FBTztZQUFhSSxTQUFTRCxLQUFLQyxXQUFXO1FBQWdCLEdBQy9EO1lBQUVqRSxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21pbmRmdWwtY2FtcHVzLW5leHQvLi9hcHAvYXBpL2FpL3JvdXRlLnRzPzBiMjQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwL2FwaS9haS9yb3V0ZS50c1xyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcblxyXG4vKiogT3JkZW4gZGUgcHJlZmVyZW5jaWE6IFNvbm5ldCA0LjUgLT4gSGFpa3UgNC41IC0+IEhhaWt1IDMuNSAqL1xyXG5jb25zdCBjYW5kaWRhdGVNb2RlbHMgPSBbXHJcbiAgXCJjbGF1ZGUtc29ubmV0LTQtNS0yMDI1MDkyOVwiLFxyXG4gIFwiY2xhdWRlLWhhaWt1LTQtNS0yMDI1MTAwMVwiLFxyXG4gIFwiY2xhdWRlLTMtNS1oYWlrdS0yMDI0MTAyMlwiLFxyXG5dIGFzIGNvbnN0O1xyXG5cclxudHlwZSBDYW5kaWRhdGVNb2RlbCA9IHR5cGVvZiBjYW5kaWRhdGVNb2RlbHNbbnVtYmVyXTtcclxuXHJcbnR5cGUgUmF3QW50aHJvcGljTWVzc2FnZSA9IHtcclxuICBjb250ZW50PzogQXJyYXk8eyB0ZXh0Pzogc3RyaW5nIH0+O1xyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0SGVhZGVycygpIHtcclxuICBjb25zdCBrZXkgPSBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWTtcclxuICByZXR1cm4ge1xyXG4gICAga2V5LFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgXCJ4LWFwaS1rZXlcIjoga2V5IHx8IFwiXCIsXHJcbiAgICAgIFwiYW50aHJvcGljLXZlcnNpb25cIjogXCIyMDIzLTA2LTAxXCIsXHJcbiAgICB9IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXHJcbiAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gYnVpbGRQYXlsb2FkKHRleHQ6IHN0cmluZykge1xyXG4gIHJldHVybiB7XHJcbiAgICBtYXhfdG9rZW5zOiAxMjAwLFxyXG4gICAgbWVzc2FnZXM6IFtcclxuICAgICAge1xyXG4gICAgICAgIHJvbGU6IFwidXNlclwiLFxyXG4gICAgICAgIGNvbnRlbnQ6IGBFcmVzIHVuIGFuYWxpc3RhIGVtb2Npb25hbCBwYXJhIGVzdHVkaWFudGVzIHVuaXZlcnNpdGFyaW9zLlxyXG5EZXZ1ZWx2ZSBTT0xPIEpTT04gdsOhbGlkbyAoc2luIG1hcmtkb3duLCBzaW4gY29tZW50YXJpb3MpIGNvbiBlc3RlIEVYQUNUTyBlc3F1ZW1hOlxyXG5cclxue1xyXG4gIFwiZW1vdGlvbnNcIjogW1xyXG4gICAge1wiZW1vdGlvblwiOiBcImFuc2llZGFkXCIsIFwiaW50ZW5zaXR5XCI6IDcsIFwiY29uZmlkZW5jZVwiOiAwLjgzLCBcInBocmFzZXNcIjogW1wiLi4uXCIsXCIuLi5cIl19XHJcbiAgXSxcclxuICBcInByaW1hcnlcIjogXCJhbnNpZWRhZFwiLFxyXG4gIFwibW9vZF92ZWN0b3JcIjoge1widmFsZW5jZVwiOiAwLjMyLCBcImFyb3VzYWxcIjogMC43NH0sXHJcbiAgXCJ0cmlnZ2Vyc1wiOiBbXCIuLi5cIl0sXHJcbiAgXCJib2R5X3NpZ25hbHNcIjogW1wiLi4uXCJdLFxyXG4gIFwiY29nbml0aXZlX3BhdHRlcm5zXCI6IFtcIi4uLlwiXSxcclxuICBcInByb3RlY3RpdmVfZmFjdG9yc1wiOiBbXCIuLi5cIl0sXHJcbiAgXCJzdW1tYXJ5XCI6IFwibcOheCAxODAgY2FyYWN0ZXJlcywgdG9ubyBlbXDDoXRpY28geSBubyBjbMOtbmljb1wiLFxyXG4gIFwic3VnZ2VzdGlvbnNfcXVpY2tcIjogW1wiVGlwIDFcIiwgXCJUaXAgMlwiXSxcclxuICBcInN1Z2dlc3Rpb25zX3ByYWN0aWNlXCI6IFtcclxuICAgIHtcInRpdGxlXCI6IFwiUmVzcGlyYWNpw7NuIGJveFwiLCBcIm1pbnV0ZXNcIjogMywgXCJzdGVwc1wiOiBbXCJQYXNvIDFcIixcIlBhc28gMlwiLFwiUGFzbyAzXCJdfVxyXG4gIF0sXHJcbiAgXCJyZWRfZmxhZ3NcIjoge1wic2VsZl9oYXJtXCI6IGZhbHNlLCBcImNyaXNpc1wiOiBmYWxzZSwgXCJyZWFzb25cIjogXCJcIn0sXHJcbiAgXCJjaXRhdGlvbnNcIjogW11cclxufVxyXG5cclxuUmVnbGFzOlxyXG4tIEVtb2Npb25lcyB2w6FsaWRhczogYW5zaWVkYWQsIGNhbG1hLCBhbGVncmlhLCB0cmlzdGV6YSwgZW5vam8sIGZydXN0cmFjaW9uLCBuZXV0cmFcclxuLSBcImludGVuc2l0eVwiOiAxLi4xMCwgXCJjb25maWRlbmNlXCI6IDAuLjFcclxuLSBNw6F4IDMgZW1vY2lvbmVzOyBtw6F4IDIgZnJhc2VzIHBvciBlbW9jacOzbiAoPD02MCBjaGFycylcclxuLSBNw6F4IDIgc3VnZ2VzdGlvbnNfcXVpY2sgeSAxIHN1Z2dlc3Rpb25zX3ByYWN0aWNlICgz4oCTNSBtaW4pXHJcbi0gRXZpdGEgZGlhZ27Ds3N0aWNvcyBjbMOtbmljb3MuIFNvbG8gb3JpZW50YWNpw7NuIGRlIGJpZW5lc3Rhci5cclxuLSBFbnRyZWdhIFNPTE8gZWwgSlNPTiwgc2luIFxcYFxcYFxcYCwgc2luIHRleHRvIGV4dHJhLlxyXG5cclxuVGV4dG86XHJcblwiJHt0ZXh0fVwiYFxyXG4gICAgICB9LFxyXG4gICAgXSxcclxuICB9O1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiB0cnlNb2RlbHNJbk9yZGVyKFxyXG4gIHBheWxvYWQ6IGFueSxcclxuICBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XHJcbik6IFByb21pc2U8eyB1c2VkTW9kZWw6IENhbmRpZGF0ZU1vZGVsOyBqc29uOiBSYXdBbnRocm9waWNNZXNzYWdlIH0+IHtcclxuICBmb3IgKGNvbnN0IG1vZGVsIG9mIGNhbmRpZGF0ZU1vZGVscykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goXCJodHRwczovL2FwaS5hbnRocm9waWMuY29tL3YxL21lc3NhZ2VzXCIsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgIGhlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyAuLi5wYXlsb2FkLCBtb2RlbCB9KSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIXJlcy5vaykge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgYOKaoO+4jyAke21vZGVsfSAtPiAke3Jlcy5zdGF0dXN9ICR7cmVzLnN0YXR1c1RleHR9OiAke3RleHQuc2xpY2UoMCwgMTgwKX1gXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QganNvbiA9IChhd2FpdCByZXMuanNvbigpKSBhcyBSYXdBbnRocm9waWNNZXNzYWdlO1xyXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIFVzYW5kbyBtb2RlbG86ICR7bW9kZWx9YCk7XHJcbiAgICAgIHJldHVybiB7IHVzZWRNb2RlbDogbW9kZWwsIGpzb24gfTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYOKaoO+4jyAke21vZGVsfSAtPiBleGNlcGNpw7NuYCwgZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHRocm93IG5ldyBFcnJvcihcIk5vIGhheSBtb2RlbG9zIGRpc3BvbmlibGVzIGNvbiB0dSBBUEkga2V5LlwiKTtcclxufVxyXG5cclxuLyoqIEV4dHJhZSBlbCBwcmltZXIgYmxvcXVlIEpTT04gZGUgdW4gc3RyaW5nIG8gZGV2dWVsdmUgbnVsbCAqL1xyXG5mdW5jdGlvbiBleHRyYWN0Rmlyc3RKc29uQmxvY2soczogc3RyaW5nKTogYW55IHwgbnVsbCB7XHJcbiAgaWYgKCFzKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBtYXRjaCA9IHMubWF0Y2goL1xce1tcXHNcXFNdKlxcfS8pO1xyXG4gIGlmICghbWF0Y2gpIHJldHVybiBudWxsO1xyXG4gIHRyeSB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShtYXRjaFswXSk7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8qKiBTYW5pdGl6YSB5IHJlY29ydGEgY2FtcG9zIHBhcmEgZXZpdGFyIHZhbG9yZXMgZnVlcmEgZGUgcmFuZ28gKi9cclxuZnVuY3Rpb24gc2FuaXRpemVSZXNwb25zZShyYXc6IGFueSkge1xyXG4gIGNvbnN0IGNsYW1wID0gKHY6IG51bWJlciwgbG86IG51bWJlciwgaGk6IG51bWJlcikgPT5cclxuICAgIE1hdGgubWF4KGxvLCBNYXRoLm1pbihoaSwgTnVtYmVyLmlzRmluaXRlKHYpID8gdiA6IGxvKSk7XHJcblxyXG4gIGNvbnN0IGVtb3Rpb25zID0gQXJyYXkuaXNBcnJheShyYXc/LmVtb3Rpb25zKSA/IHJhdy5lbW90aW9ucy5zbGljZSgwLCAzKSA6IFtdO1xyXG4gIGNvbnN0IHNhZmVFbW90aW9ucyA9IGVtb3Rpb25zLm1hcCgoZTogYW55KSA9PiAoe1xyXG4gICAgZW1vdGlvbjpcclxuICAgICAgKFtcImFuc2llZGFkXCIsIFwiY2FsbWFcIiwgXCJhbGVncmlhXCIsIFwidHJpc3RlemFcIiwgXCJlbm9qb1wiLCBcImZydXN0cmFjaW9uXCIsIFwibmV1dHJhXCJdIGFzIGNvbnN0KS5pbmNsdWRlcyhcclxuICAgICAgICBlPy5lbW90aW9uXHJcbiAgICAgIClcclxuICAgICAgICA/IGUuZW1vdGlvblxyXG4gICAgICAgIDogXCJuZXV0cmFcIixcclxuICAgIGludGVuc2l0eTogY2xhbXAoZT8uaW50ZW5zaXR5ID8/IDUsIDEsIDEwKSxcclxuICAgIGNvbmZpZGVuY2U6IGNsYW1wKGU/LmNvbmZpZGVuY2UgPz8gMC43LCAwLCAxKSxcclxuICAgIHBocmFzZXM6IEFycmF5LmlzQXJyYXkoZT8ucGhyYXNlcykgPyBlLnBocmFzZXMuc2xpY2UoMCwgMikgOiBbXSxcclxuICB9KSk7XHJcblxyXG4gIGNvbnN0IHByaW1hcnkgPVxyXG4gICAgKFtcImFuc2llZGFkXCIsIFwiY2FsbWFcIiwgXCJhbGVncmlhXCIsIFwidHJpc3RlemFcIiwgXCJlbm9qb1wiLCBcImZydXN0cmFjaW9uXCIsIFwibmV1dHJhXCJdIGFzIGNvbnN0KS5pbmNsdWRlcyhcclxuICAgICAgcmF3Py5wcmltYXJ5XHJcbiAgICApXHJcbiAgICAgID8gcmF3LnByaW1hcnlcclxuICAgICAgOiBzYWZlRW1vdGlvbnNbMF0/LmVtb3Rpb24gPz8gXCJuZXV0cmFcIjtcclxuXHJcbiAgY29uc3QgbW9vZF92ZWN0b3IgPSB7XHJcbiAgICB2YWxlbmNlOiBjbGFtcChyYXc/Lm1vb2RfdmVjdG9yPy52YWxlbmNlID8/IDAuNSwgMCwgMSksXHJcbiAgICBhcm91c2FsOiBjbGFtcChyYXc/Lm1vb2RfdmVjdG9yPy5hcm91c2FsID8/IDAuNSwgMCwgMSksXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgYXJyID0gKHg6IGFueSkgPT4gKEFycmF5LmlzQXJyYXkoeCkgPyB4IDogW10pO1xyXG4gIGNvbnN0IHN0ciA9ICh4OiBhbnksIG1heCA9IDE4MCkgPT5cclxuICAgIHR5cGVvZiB4ID09PSBcInN0cmluZ1wiID8geC5zbGljZSgwLCBtYXgpIDogXCJcIjtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSB7XHJcbiAgICBlbW90aW9uczogc2FmZUVtb3Rpb25zLFxyXG4gICAgcHJpbWFyeSxcclxuICAgIG1vb2RfdmVjdG9yLFxyXG4gICAgdHJpZ2dlcnM6IGFycihyYXc/LnRyaWdnZXJzKS5zbGljZSgwLCA2KSxcclxuICAgIGJvZHlfc2lnbmFsczogYXJyKHJhdz8uYm9keV9zaWduYWxzKS5zbGljZSgwLCA2KSxcclxuICAgIGNvZ25pdGl2ZV9wYXR0ZXJuczogYXJyKHJhdz8uY29nbml0aXZlX3BhdHRlcm5zKS5zbGljZSgwLCA2KSxcclxuICAgIHByb3RlY3RpdmVfZmFjdG9yczogYXJyKHJhdz8ucHJvdGVjdGl2ZV9mYWN0b3JzKS5zbGljZSgwLCA2KSxcclxuICAgIHN1bW1hcnk6IHN0cihyYXc/LnN1bW1hcnksIDE4MCksXHJcbiAgICBzdWdnZXN0aW9uc19xdWljazogYXJyKHJhdz8uc3VnZ2VzdGlvbnNfcXVpY2spLnNsaWNlKDAsIDIpLFxyXG4gICAgc3VnZ2VzdGlvbnNfcHJhY3RpY2U6IGFycihyYXc/LnN1Z2dlc3Rpb25zX3ByYWN0aWNlKVxyXG4gICAgICAuc2xpY2UoMCwgMSlcclxuICAgICAgLm1hcCgocDogYW55KSA9PiAoe1xyXG4gICAgICAgIHRpdGxlOiBzdHIocD8udGl0bGUsIDYwKSB8fCBcIlByw6FjdGljYSBicmV2ZVwiLFxyXG4gICAgICAgIG1pbnV0ZXM6IE1hdGgubWF4KDEsIE1hdGgubWluKDEwLCBOdW1iZXIocD8ubWludXRlcykgfHwgMykpLFxyXG4gICAgICAgIHN0ZXBzOiBhcnIocD8uc3RlcHMpLnNsaWNlKDAsIDUpLFxyXG4gICAgICB9KSksXHJcbiAgICByZWRfZmxhZ3M6IHtcclxuICAgICAgc2VsZl9oYXJtOiAhIXJhdz8ucmVkX2ZsYWdzPy5zZWxmX2hhcm0sXHJcbiAgICAgIGNyaXNpczogISFyYXc/LnJlZF9mbGFncz8uY3Jpc2lzLFxyXG4gICAgICByZWFzb246IHN0cihyYXc/LnJlZF9mbGFncz8ucmVhc29uLCAxMjApLFxyXG4gICAgfSxcclxuICAgIGNpdGF0aW9uczogYXJyKHJhdz8uY2l0YXRpb25zKS5zbGljZSgwLCA0KSxcclxuICB9O1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zb2xlLmxvZyhcIj09PSBJTklDSU8gL2FwaS9haSA9PT1cIik7XHJcbiAgY29uc3QgeyBrZXksIGhlYWRlcnMgfSA9IGdldEhlYWRlcnMoKTtcclxuICBjb25zb2xlLmxvZyhcIvCflJEgQVBJIEtleTpcIiwga2V5ID8gXCJTw40g4pyFXCIgOiBcIk5PIOKdjFwiKTtcclxuICBpZiAoa2V5KSBjb25zb2xlLmxvZyhcIvCflJEgUHJlOlwiLCBrZXkuc2xpY2UoMCwgMjApICsgXCIuLi5cIik7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHRleHQgfSA9IGF3YWl0IHJlcS5qc29uKCk7XHJcbiAgICBjb25zdCBwcmV2aWV3ID0gdHlwZW9mIHRleHQgPT09IFwic3RyaW5nXCIgPyB0ZXh0LnNsaWNlKDAsIDEyMCkgOiBcIlwiO1xyXG4gICAgY29uc29sZS5sb2coXCLwn5OdIFRleHRvOlwiLCBwcmV2aWV3ICsgKHRleHQ/Lmxlbmd0aCA+IDEyMCA/IFwiLi4uXCIgOiBcIlwiKSk7XHJcblxyXG4gICAgaWYgKCF0ZXh0IHx8IHR5cGVvZiB0ZXh0ICE9PSBcInN0cmluZ1wiIHx8IHRleHQudHJpbSgpLmxlbmd0aCA8IDIwKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBcIlRleHRvIGluc3VmaWNpZW50ZSAobcOtbmltbyAyMCBjYXJhY3RlcmVzKVwiIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFrZXkpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6IFwiTWlzc2luZyBBTlRIUk9QSUNfQVBJX0tFWVwiIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF5bG9hZCA9IGJ1aWxkUGF5bG9hZCh0ZXh0KTtcclxuICAgIGNvbnN0IHsgdXNlZE1vZGVsLCBqc29uIH0gPSBhd2FpdCB0cnlNb2RlbHNJbk9yZGVyKHBheWxvYWQsIGhlYWRlcnMpO1xyXG5cclxuICAgIC8vIExhIEFQSSBkZXZ1ZWx2ZSBhbGdvIHRpcG86IHsgY29udGVudDogW3sgdGV4dDogXCIuLi4oSlNPTiBvIHRleHRvKS4uLlwiIH1dLCAuLi4gfVxyXG4gICAgY29uc3QgY29udGVudCA9IGpzb24/LmNvbnRlbnQ/LlswXT8udGV4dCA/PyBcIlwiO1xyXG4gICAgY29uc3QgcGFyc2VkID0gZXh0cmFjdEZpcnN0SnNvbkJsb2NrKGNvbnRlbnQpO1xyXG4gICAgaWYgKCFwYXJzZWQpIHtcclxuICAgICAgY29uc29sZS5sb2coXCLinYwgTm8gc2UgZW5jb250csOzIEpTT04gZW4gbGEgcmVzcHVlc3RhIGJydXRhXCIpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogXCJObyBKU09OIGZvdW5kIGluIHVwc3RyZWFtIHJlc3BvbnNlXCIgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAyIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVJlc3BvbnNlKHBhcnNlZCk7XHJcbiAgICBjb25zb2xlLmxvZyhcIuKchSBPSyAtPlwiLCB1c2VkTW9kZWwpO1xyXG4gICAgY29uc29sZS5sb2coXCI9PT0gRklOIC9hcGkvYWkgPT09XCIpO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHVzZWRNb2RlbCxcclxuICAgICAgLi4uc2FuaXRpemVkLFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRVhDRVBUSU9OIC9hcGkvYWk6XCIsIGVycj8ubWVzc2FnZSB8fCBlcnIpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBcIkV4Y2VwdGlvblwiLCBtZXNzYWdlOiBlcnI/Lm1lc3NhZ2UgfHwgXCJVbmtub3duIGVycm9yXCIgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY2FuZGlkYXRlTW9kZWxzIiwiZ2V0SGVhZGVycyIsImtleSIsInByb2Nlc3MiLCJlbnYiLCJBTlRIUk9QSUNfQVBJX0tFWSIsImhlYWRlcnMiLCJidWlsZFBheWxvYWQiLCJ0ZXh0IiwibWF4X3Rva2VucyIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJ0cnlNb2RlbHNJbk9yZGVyIiwicGF5bG9hZCIsIm1vZGVsIiwicmVzIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwiY29uc29sZSIsImxvZyIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJzbGljZSIsImpzb24iLCJ1c2VkTW9kZWwiLCJlIiwiRXJyb3IiLCJleHRyYWN0Rmlyc3RKc29uQmxvY2siLCJzIiwibWF0Y2giLCJwYXJzZSIsInNhbml0aXplUmVzcG9uc2UiLCJyYXciLCJjbGFtcCIsInYiLCJsbyIsImhpIiwiTWF0aCIsIm1heCIsIm1pbiIsIk51bWJlciIsImlzRmluaXRlIiwiZW1vdGlvbnMiLCJBcnJheSIsImlzQXJyYXkiLCJzYWZlRW1vdGlvbnMiLCJtYXAiLCJlbW90aW9uIiwiaW5jbHVkZXMiLCJpbnRlbnNpdHkiLCJjb25maWRlbmNlIiwicGhyYXNlcyIsInByaW1hcnkiLCJtb29kX3ZlY3RvciIsInZhbGVuY2UiLCJhcm91c2FsIiwiYXJyIiwieCIsInN0ciIsInJlc3BvbnNlIiwidHJpZ2dlcnMiLCJib2R5X3NpZ25hbHMiLCJjb2duaXRpdmVfcGF0dGVybnMiLCJwcm90ZWN0aXZlX2ZhY3RvcnMiLCJzdW1tYXJ5Iiwic3VnZ2VzdGlvbnNfcXVpY2siLCJzdWdnZXN0aW9uc19wcmFjdGljZSIsInAiLCJ0aXRsZSIsIm1pbnV0ZXMiLCJzdGVwcyIsInJlZF9mbGFncyIsInNlbGZfaGFybSIsImNyaXNpcyIsInJlYXNvbiIsImNpdGF0aW9ucyIsIlBPU1QiLCJyZXEiLCJwcmV2aWV3IiwibGVuZ3RoIiwidHJpbSIsImVycm9yIiwicGFyc2VkIiwic2FuaXRpemVkIiwiZXJyIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ai/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai%2Froute&page=%2Fapi%2Fai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai%2Froute.ts&appDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ctrevo%5COneDrive%5CIm%C3%A1genes%5Cmindful-campus-next%5Cmindful-campus-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();